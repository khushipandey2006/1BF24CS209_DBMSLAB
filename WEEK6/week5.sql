create database company;
use company;
create table PROJECT(
PNO int primary key,
PLOC varchar(50),
PNAME varchar(50));
create table DEPT(
DEPTNO INT PRIMARY KEY,
DNAME VARCHAR(50),
DLOC VARCHAR(40));
CREATE TABLE EMPLOYEE(
EMPNO INT ,
ENAME VARCHAR(50),
MGR_NO INT,
HIREDATE DATE,
SAL INT,
DEPTNO INT,
PRIMARY KEY(EMPNO,DEPTNO),
FOREIGN KEY(DEPTNO) REFERENCES DEPT(DEPTNO));
CREATE TABLE INCENTIVES(
EMPNO INT,
INCENTIVE_DATE DATE,
INCENCTIVE_AMOUNT INT,
PRIMARY KEY(EMPNO, INCENTIVE_DATE),
FOREIGN KEY(EMPNO) REFERENCES EMPLOYEE(EMPNO));
CREATE TABLE ASSIGNED_TO(
EMPNO INT,
PNO INT,
JOB_ROLE VARCHAR(20),
PRIMARY KEY(EMPNO, PNO),
FOREIGN KEY(EMPNO) REFERENCES EMPLOYEE(EMPNO),
FOREIGN KEY (PNO) REFERENCES PROJECT(PNO));

INSERT INTO DEPT VALUES
(1,'IT','BENGALURU'),
(2,'FINANCE','HYDERABAD'),
(3,'HR','MYSURU'),
(4,'SALES','PUNE'),
(5,'MARKETING','DELHI'),
(6,'CSE','BENGALURU');

INSERT INTO EMPLOYEE VALUES
(101,'RIYA',105,'2020-05-10',55000,1),
(102,'ARJUN',105,'2019-07-18',60000,2),
(103,'SNEHA',101,'2021-03-25',50000,3),
(104,'KIRAN',NULL,'2018-12-10',65000,1),
(105,'MEENA',104,'2019-09-14',48000,4),
(106,'ROHIT',104,'2022-01-19',62000,5);

INSERT INTO PROJECT VALUES
(501,'ALPHA','BENGALURU'),
(502,'BETA','HYDERABAD'),
(503,'GAMMA','MYSURU'),
(504,'DELTA','DELHI'),
(505,'SIGMA','PUNE');

INSERT INTO ASSIGNED_TO VALUES
(101,501,'DEVELOPER'),
(102,502,'ANALYST'),
(103,503,'TESTER'),
(104,501,'DEVELOPER'),
(105,504,'HR MANAGER'),
(106,505,'SALES EXECUTIVE');

TRUNCATE TABLE INCENTIVES;

INSERT INTO INCENTIVES VALUES
(101,'2024-03-01',5000),
(102,'2024-04-10',3000),
(103,'2024-05-15',2500),
(104,'2024-06-12',4000),
(105,'2025-01-05',2000);

SELECT EMPNO
FROM ASSIGNED_TO A, PROJECT P 
WHERE A.PNO=P.PNO
AND P.PLOC IN ('BENGALURU','HYDERABAD','MYSURU');

SELECT E.EMPNO
FROM EMPLOYEE E
WHERE E.EMPNO NOT IN(
	SELECT EMPNO
    FROM INCENTIVES);

SELECT E.EMPNO,E.ENAME,D.DNAME AS DEPARTMENT,
	A.JOB_ROLE,D.DLOC AS DEPT_LOCATION,
    P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D
ON E.DEPTNO=D.DEPTNO
JOIN ASSIGNED_TO A
ON E.EMPNO=A.EMPNO
JOIN PROJECT P 
ON A.PNO=P.PNO
WHERE UPPER(TRIM(D.DLOC))=UPPER(TRIM(P.PLOC))
AND E.DEPTNO IS NOT NULL;

SELECT * FROM DEPT;
SELECT * FROM EMPLOYEE;
SELECT * FROM PROJECT;
SELECT * FROM ASSIGNED_TO;
SELECT * FROM INCENTIVES;

SELECT E.ENAME AS MGR_NAME
FROM EMPLOYEE E
WHERE E.EMPNO IN (
    SELECT MGR_NO
    FROM EMPLOYEE
    GROUP BY MGR_NO
    HAVING E.SAL >AVG(SAL)
);

SELECT DISTINCT E.ENAME
AS SECOND_LEVEL_MANAGER,D.DNAME AS DEPT_NAME
FROM EMPLOYEE E
JOIN EMPLOYEE M
ON E.MGR_NO=M.EMPNO
JOIN E ON M.MGR_NO=E.EMPNO
JOIN EMPLOYEE D ON E.DEPTNO=D.DEPTNO
ORDER BY D.DEPTNO,E.ENAME;